<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>STEM Lab Pro - Hydrolysis of Ethyl Acetate</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />

  <!-- React & ReactDOM (UMD) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel (for JSX) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
            mono: ['JetBrains Mono', 'monospace'],
          },
          colors: {
            cyan: {
              400: '#22d3ee',
              500: '#06b6d4',
              900: '#164e63',
            },
            violet: {
              900: '#4c1d95',
            }
          },
          animation: {
            'blob': 'blob 7s infinite',
            'flame': 'flame 0.5s infinite alternate',
            'bubble': 'bubble 2s infinite',
          },
          keyframes: {
            blob: {
              '0%': { transform: 'translate(0px, 0px) scale(1)' },
              '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
              '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
              '100%': { transform: 'translate(0px, 0px) scale(1)' },
            },
            flame: {
              '0%': { transform: 'scale(1)', opacity: '0.9' },
              '100%': { transform: 'scale(1.1)', opacity: '1' },
            },
            bubble: {
              '0%': { transform: 'translateY(0) scale(1)', opacity: '0' },
              '50%': { opacity: '1' },
              '100%': { transform: 'translateY(-20px) scale(1.2)', opacity: '0' },
            }
          }
        }
      }
    }
  </script>
  <style>
    body {
      background-color: #0f172a;
      color: #e2e8f0;
    }
    .glass-panel {
      background: rgba(15, 23, 42, 0.6);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(34, 211, 238, 0.2);
    }
    .liquid-layer {
      transition: height 1s ease-in-out, background-color 1s ease-in-out;
    }
  </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.4",
    "react-dom/": "https://esm.sh/react-dom@^19.2.4/",
    "react/": "https://esm.sh/react@^19.2.4/"
  }
}
</script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // --- Types & Constants ---

    const STEPS = [
      {
        id: 1,
        title: "Bước 1: Chuẩn bị",
        instructions: "Cho vào 2 ống nghiệm, mỗi ống 2 ml etyl axetat.",
        phenomenon: "Chất lỏng trong suốt, chưa có phản ứng.",
        actionLabel: "Thêm Etyl Axetat"
      },
      {
        id: 2,
        title: "Bước 2: Xúc tác",
        instructions: "Ống 1: +2ml H₂SO₄ 20%. Ống 2: +4ml NaOH 30%. Lắc đều.",
        phenomenon: "Chất lỏng phân lớp (Etyl axetat nhẹ hơn nước).",
        actionLabel: "Thêm H₂SO₄ / NaOH"
      },
      {
        id: 3,
        title: "Bước 3: Đun nóng",
        instructions: "Lắp ống sinh hàn, đun nóng nhẹ ~5 phút.",
        phenomenon: "Axit: Phân lớp, mùi este. Bazơ: Đồng nhất, hết mùi.",
        actionLabel: "Bật bếp đun"
      }
    ];

    // --- Components ---

    const Header = () => (
      <header className="flex items-center justify-between px-6 py-4 glass-panel border-b-0 sticky top-0 z-50">
        <div className="flex items-center gap-3">
          <div className="bg-cyan-500/20 text-cyan-300 px-3 py-1 rounded-full text-xs font-bold border border-cyan-500/50 tracking-wider">
            STEM LAB PRO
          </div>
          <h1 className="text-xl font-bold text-white tracking-tight">THÍ NGHIỆM THỦY PHÂN ETYL AXETAT</h1>
        </div>
        <div className="text-sm font-medium text-slate-400 bg-slate-800/50 px-3 py-1 rounded-lg border border-slate-700">
          Hóa học 12
        </div>
      </header>
    );

    const ReactionEquation = () => (
      <div className="glass-panel rounded-xl p-6 mt-4">
        <h3 className="text-cyan-400 font-bold mb-4 flex items-center gap-2">
          <span className="material-symbols-outlined text-sm">science</span>
          CƠ CHẾ VÀ PHƯƠNG TRÌNH PHẢN ỨNG
        </h3>
        <div className="grid md:grid-cols-2 gap-8">
          <div>
            <div className="text-sm text-slate-400 mb-1 font-mono">Môi trường axit (H₂SO₄, t°):</div>
            <div className="bg-slate-900/50 p-3 rounded border border-slate-700/50 font-mono text-sm text-yellow-200">
              CH₃COOC₂H₅ + H₂O ⇌ CH₃COOH + C₂H₅OH
            </div>
            <div className="text-xs text-slate-500 mt-2 italic">
              * Phản ứng thuận nghịch, hiệu suất không cao, vẫn còn este dư (phân lớp).
            </div>
          </div>
          <div>
            <div className="text-sm text-slate-400 mb-1 font-mono">Môi trường bazơ (NaOH, t°):</div>
            <div className="bg-slate-900/50 p-3 rounded border border-slate-700/50 font-mono text-sm text-green-200">
              CH₃COOC₂H₅ + NaOH → CH₃COONa + C₂H₅OH
            </div>
            <div className="text-xs text-slate-500 mt-2 italic">
              * Phản ứng một chiều (xà phòng hóa), xảy ra hoàn toàn (đồng nhất).
            </div>
          </div>
        </div>
      </div>
    );

    // --- Simulation Components ---

    const Flame = () => (
      <div className="relative w-10 h-12 mx-auto mt-[-5px] z-10">
        <div className="absolute bottom-0 left-1/2 -translate-x-1/2 w-4 h-8 bg-orange-500 rounded-full blur-[2px] animate-flame origin-bottom"></div>
        <div className="absolute bottom-0 left-1/2 -translate-x-1/2 w-2 h-5 bg-yellow-300 rounded-full blur-[1px] animate-flame origin-bottom delay-75"></div>
      </div>
    );

    const Bubbles = () => (
      <div className="absolute inset-0 overflow-hidden rounded-b-full pointer-events-none">
        {[...Array(5)].map((_, i) => (
          <div 
            key={i}
            className="absolute w-1 h-1 bg-white/40 rounded-full animate-bubble"
            style={{
              left: `${20 + Math.random() * 60}%`,
              bottom: '10%',
              animationDelay: `${Math.random() * 2}s`
            }}
          />
        ))}
      </div>
    );

    const Flask = ({ 
      type, 
      step, 
      isHeating 
    }) => {
      // Visual state calculation
      const hasLiquid = step >= 1;
      const hasReagent = step >= 2;
      const isFinished = step === 3;

      // Layer 1 (Bottom - Water/Acid/Base)
      const bottomHeight = hasLiquid ? (hasReagent ? '60%' : '30%') : '0%';
      const bottomColor = type === 'acid' 
        ? (hasReagent ? 'bg-yellow-100/20' : 'bg-slate-200/10')
        : (hasReagent ? 'bg-blue-100/20' : 'bg-slate-200/10');

      let topHeight = '0%';
      if (step === 1) topHeight = '30%'; // Only EA
      if (step === 2) topHeight = '30%'; // EA floating on reagents

      if (step === 3) {
          if (type === 'acid') topHeight = '20%'; // Some EA remains
          if (type === 'base') topHeight = '0%';  // Consumed
      }

      // Refined Logic for Visuals
      const getVisuals = () => {
        if (step === 0) return { botH: '0%', topH: '0%', botC: '', topC: '' };
        if (step === 1) return { botH: '20%', topH: '0%', botC: 'bg-teal-100/20', topC: '' }; // Just EA
        if (step === 2) {
           // Separation
           return { 
             botH: type === 'acid' ? '30%' : '40%', 
             topH: '20%', 
             botC: type === 'acid' ? 'bg-yellow-500/10' : 'bg-blue-500/10',
             topC: 'bg-teal-100/30' // EA
           };
        }
        if (step === 3) {
          // Heated
          if (type === 'acid') {
             return { botH: '35%', topH: '15%', botC: 'bg-yellow-600/20', topC: 'bg-teal-100/20' }; // Still separated
          } else {
             return { botH: '60%', topH: '0%', botC: 'bg-slate-200/30', topC: '' }; // Homogeneous
          }
        }
        return { botH: '0%', topH: '0%', botC: '', topC: '' };
      };

      const { botH, topH, botC, topC } = getVisuals();

      return (
        <div className="flex flex-col items-center justify-end h-80 relative w-48">
           {/* Condenser Visual */}
           <div className="absolute top-0 w-4 h-32 border-2 border-slate-500/50 rounded-sm bg-slate-800/30 z-0 flex flex-col justify-between items-center py-2">
               <div className="w-6 h-0.5 bg-slate-600 relative right-3">
                 <span className="absolute -left-12 -top-2 text-[9px] text-cyan-300">H₂O out</span>
               </div>
               {/* Inner tube */}
               <div className="w-1.5 h-full bg-slate-400/20 border-l border-r border-slate-600/30"></div>
               <div className="w-6 h-0.5 bg-slate-600 relative right-3">
                  <span className="absolute -left-10 -top-1 text-[9px] text-cyan-300">H₂O in</span>
               </div>
           </div>

           {/* Flask Neck */}
           <div className="w-6 h-12 bg-slate-300/10 border-l-2 border-r-2 border-slate-400/50 backdrop-blur-sm z-10 relative mt-24"></div>

           {/* Flask Body */}
           <div className="w-32 h-32 rounded-full border-2 border-slate-400/50 bg-slate-300/5 backdrop-blur-md relative overflow-hidden -mt-1 z-10 shadow-[0_0_15px_rgba(34,211,238,0.1)]">
              {/* Liquids */}
              <div className="absolute bottom-0 w-full transition-all duration-1000 ease-in-out" style={{ height: `calc(${botH} + ${topH})` }}>
                 {/* Top Layer */}
                 <div className={`w-full transition-all duration-1000 ${topC}`} style={{ height: step === 2 || step === 3 ? '40%' : '0%' }}></div>
                 {/* Bottom Layer */}
                 <div className={`w-full transition-all duration-1000 ${botC} flex items-end justify-center h-full`}></div>
              </div>
              
              {/* Specific bubbles for heating */}
              {isHeating && <Bubbles />}

              {/* Glare */}
              <div className="absolute top-4 left-4 w-8 h-4 bg-white/10 rounded-full -rotate-45 blur-[2px]"></div>
           </div>

           {/* Label */}
           <div className="mt-4 font-mono text-sm text-center">
             <div className="font-bold text-slate-200">{type === 'acid' ? 'Môi trường Axit' : 'Môi trường Bazơ'}</div>
             <div className="text-xs text-slate-400 mt-1">{type === 'acid' ? '+ H₂SO₄' : '+ NaOH'}</div>
           </div>

           {/* Flame */}
           <div className={`mt-2 h-8 transition-opacity duration-500 ${isHeating ? 'opacity-100' : 'opacity-0'}`}>
             <Flame />
           </div>
        </div>
      );
    };

    // --- Main App Component ---

    const App = () => {
      const [currentStep, setCurrentStep] = useState(0);
      const [isHeating, setIsHeating] = useState(false);

      // Auto-stop heating simulation
      useEffect(() => {
        if (currentStep === 3) {
          setIsHeating(true);
          const timer = setTimeout(() => setIsHeating(false), 5000); // Heat for 5s
          return () => clearTimeout(timer);
        } else {
          setIsHeating(false);
        }
      }, [currentStep]);

      const handleNextStep = () => {
        if (currentStep < 3) setCurrentStep(prev => prev + 1);
      };

      const handleReset = () => {
        setCurrentStep(0);
        setIsHeating(false);
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-[#0f172a] via-[#1e1b4b] to-[#312e81] text-slate-100 font-sans pb-10">
          <Header />

          <main className="container mx-auto px-4 mt-6 grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            {/* Left Column: Simulation Area */}
            <div className="lg:col-span-8 flex flex-col gap-6">
              {/* Experiment Viewport */}
              <div className="glass-panel rounded-2xl p-8 min-h-[500px] flex flex-col relative overflow-hidden">
                {/* Background Grid Pattern */}
                <div className="absolute inset-0 opacity-10 pointer-events-none" 
                  style={{ backgroundImage: 'radial-gradient(circle, #475569 1px, transparent 1px)', backgroundSize: '24px 24px' }}>
                </div>

                <div className="flex-1 flex justify-around items-end pb-12 z-10">
                   <Flask type="acid" step={currentStep} isHeating={isHeating} />
                   <Flask type="base" step={currentStep} isHeating={isHeating} />
                </div>

                {/* Controls Overlay */}
                <div className="absolute bottom-6 left-1/2 -translate-x-1/2 flex gap-4 z-20">
                   <button 
                     onClick={handleReset}
                     className="px-4 py-2 rounded-lg border border-red-500/50 text-red-400 hover:bg-red-500/10 transition flex items-center gap-2"
                   >
                     <span className="material-symbols-outlined">restart_alt</span>
                     Làm lại
                   </button>
                   
                   {currentStep < 3 && (
                     <button 
                       onClick={handleNextStep}
                       className="px-6 py-2 rounded-lg bg-cyan-500 text-black font-bold hover:bg-cyan-400 shadow-[0_0_20px_rgba(6,182,212,0.3)] transition flex items-center gap-2 animate-pulse"
                     >
                       <span>{currentStep === 0 ? "Bắt đầu thí nghiệm" : STEPS[currentStep].actionLabel}</span>
                       <span className="material-symbols-outlined">arrow_forward</span>
                     </button>
                   )}
                </div>
              </div>

              <ReactionEquation />
            </div>

            {/* Right Column: Steps & Tools */}
            <div className="lg:col-span-4 flex flex-col gap-6 h-full">
              
              {/* Steps List */}
              <div className="glass-panel rounded-xl p-5 h-full">
                <h2 className="text-lg font-bold text-white mb-4 flex items-center gap-2">
                  <span className="material-symbols-outlined text-cyan-400">playlist_play</span>
                  Quy trình thí nghiệm
                </h2>
                <div className="space-y-3">
                  {STEPS.map((step) => {
                    const isActive = currentStep === step.id;
                    const isDone = currentStep > step.id;
                    
                    return (
                      <div 
                        key={step.id}
                        className={`relative p-4 rounded-lg border transition-all duration-300 ${
                          isActive 
                            ? 'bg-cyan-900/30 border-cyan-500/50 shadow-[0_0_15px_rgba(34,211,238,0.1)] translate-x-1' 
                            : isDone
                              ? 'bg-slate-800/50 border-slate-700 opacity-60'
                              : 'bg-slate-900/30 border-slate-800 opacity-40'
                        }`}
                      >
                        {isActive && (
                          <div className="absolute left-0 top-0 bottom-0 w-1 bg-cyan-400 rounded-l-lg"></div>
                        )}
                        <div className="flex justify-between items-start mb-2">
                          <span className={`text-sm font-bold ${isActive ? 'text-cyan-300' : 'text-slate-400'}`}>
                            {step.title}
                          </span>
                          {isDone && <span className="material-symbols-outlined text-green-400 text-sm">check_circle</span>}
                        </div>
                        <p className="text-sm text-slate-300 mb-2">{step.instructions}</p>
                        {isActive && (
                          <div className="mt-2 text-xs bg-slate-950/50 p-2 rounded border border-slate-700/50 text-yellow-200">
                            <span className="font-bold">Hiện tượng:</span> {step.phenomenon}
                          </div>
                        )}
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>
          </main>
        </div>
      );
    };

    // Render App
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>